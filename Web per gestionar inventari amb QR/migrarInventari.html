<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Migrar Inventari a Firebase</title>
</head>
<body>
    <h2>Migraci√≥ inventari.json a Firestore</h2>
    <input type="file" id="jsonFile" accept=".json">
    <button id="migrarBtn">Migrar a Firebase</button>
    <div id="resultat"></div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDqsy5zE7YnUuMt80ZskvvUVFjIiVTdOB8",
            authDomain: "inventari-pc-s.firebaseapp.com",
            projectId: "inventari-pc-s",
            storageBucket: "inventari-pc-s.firebasestorage.app",
            messagingSenderId: "998595234302",
            appId: "1:998595234302:web:d253d36f99d82b549f18af",
            measurementId: "G-0QM2VV5NZD"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.getElementById('migrarBtn').onclick = async () => {
            const fileInput = document.getElementById('jsonFile');
            if (!fileInput.files.length) {
                alert('Selecciona el fitxer inventari.json!');
                return;
            }
            const file = fileInput.files[0];
            const text = await file.text();
            let inventari;
            try {
                inventari = JSON.parse(text);
            } catch (e) {
                alert('Error llegint el JSON!');
                return;
            }
            let migrats = 0;
            for (const pc of inventari) {
                if (!pc.id) continue;
                pc.reparacions = pc.reparacions || [];
                try {
                    await setDoc(doc(db, "pcs", pc.id.toString()), pc);
                    migrats++;
                } catch (e) {
                    console.error(e);
                }
            }
            document.getElementById('resultat').innerText = `Migrats ${migrats} dispositius a Firestore!`;
        };
    </script>
</body>
</html>